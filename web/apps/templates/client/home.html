{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="w-full flex flex-col h-screen bg-white">
    <div class="relative shadow-md rounded-lg text-xs md:text-sm">
        <div class="bg-white p-3 md:p-5">
            <div class="flex flex-col justify-between dark:bg-gray-800 space-y-3">
                <div class="flex justify-between h-10">
                    <div
                        class="flex items-center justify-center w-20 h-10"
                    >
                        <div
                            id="loading-indicator"
                            class="hidden px-3 py-1 text-xs font-medium leading-none text-center text-blue-800 bg-blue-200 rounded-full animate-pulse dark:bg-blue-900 dark:text-blue-200"
                        >loading...</div>
                    </div>
                    <button
                        type="button"
                        class="inline-flex h-full items-center text-gray-500 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg px-3 py-2.5 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700"
                        data-modal-target="small-modal"
                        data-modal-toggle="small-modal"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="md:mr-3 hidden">
                            <path d="M14.707 4.79306L10.707 0.793055C10.6141 0.699929 10.5038 0.626043 10.3823 0.57563C10.2608 0.525217 10.1305 0.499268 9.999 0.499268C9.86747 0.499268 9.73722 0.525217 9.61573 0.57563C9.49424 0.626043 9.38389 0.699929 9.291 0.793055L5.291 4.79306C5.10349 4.98083 4.99826 5.2354 4.99844 5.50076C4.99863 5.76613 5.10423 6.02055 5.292 6.20806C5.47977 6.39556 5.73434 6.5008 5.99971 6.50061C6.26507 6.50042 6.51949 6.39483 6.707 6.20706L9 3.91406V12.5001C9 12.7653 9.10536 13.0196 9.29289 13.2072C9.48043 13.3947 9.73478 13.5001 10 13.5001C10.2652 13.5001 10.5196 13.3947 10.7071 13.2072C10.8946 13.0196 11 12.7653 11 12.5001V3.91406L13.293 6.20706C13.4816 6.38921 13.7342 6.49001 13.9964 6.48773C14.2586 6.48545 14.5094 6.38028 14.6948 6.19487C14.8802 6.00947 14.9854 5.75865 14.9877 5.49646C14.99 5.23426 14.8892 4.98166 14.707 4.79306Z" fill="#2F2F38"/>
                            <path d="M18 12.0001H13V12.5001C13 13.2957 12.6839 14.0588 12.1213 14.6214C11.5587 15.184 10.7956 15.5001 10 15.5001C9.20435 15.5001 8.44129 15.184 7.87868 14.6214C7.31607 14.0588 7 13.2957 7 12.5001V12.0001H2C1.46957 12.0001 0.960859 12.2108 0.585786 12.5858C0.210714 12.9609 0 13.4696 0 14.0001V18.0001C0 18.5305 0.210714 19.0392 0.585786 19.4143C0.960859 19.7893 1.46957 20.0001 2 20.0001H18C18.5304 20.0001 19.0391 19.7893 19.4142 19.4143C19.7893 19.0392 20 18.5305 20 18.0001V14.0001C20 13.4696 19.7893 12.9609 19.4142 12.5858C19.0391 12.2108 18.5304 12.0001 18 12.0001ZM15 17.0001C14.8022 17.0001 14.6089 16.9414 14.4444 16.8315C14.28 16.7216 14.1518 16.5655 14.0761 16.3827C14.0004 16.2 13.9806 15.9989 14.0192 15.805C14.0578 15.611 14.153 15.4328 14.2929 15.2929C14.4327 15.1531 14.6109 15.0579 14.8049 15.0193C14.9989 14.9807 15.2 15.0005 15.3827 15.0762C15.5654 15.1519 15.7216 15.28 15.8315 15.4445C15.9414 15.6089 16 15.8023 16 16.0001C16 16.2653 15.8946 16.5196 15.7071 16.7072C15.5196 16.8947 15.2652 17.0001 15 17.0001Z" fill="#2F2F38"/>
                        </svg>
                        <div>
                            Add product
                        </div>
                    </button>
                </div>
                <div class="flex justify-between h-10">
                    <button
                        id="dropdownActionButton"
                        data-dropdown-toggle="dropdownAction"
                        class="inline-flex h-full items-center text-gray-500 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg px-3 py-2 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700" type="button"
                    >
                        <span class="sr-only">Action button</span>
                        Action
                        <svg class="w-2.5 h-2.5 ml-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                        </svg>
                    </button>
                    <!-- Dropdown menu -->
                    <div id="dropdownAction" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dark:divide-gray-600">
                        <ul class="py-1 text-gray-700 dark:text-gray-200" aria-labelledby="dropdownActionButton">
                            <li>
                                <button
                                    class="w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
                                    onclick="onclick_action_button('ACTIVATE')"
                                >Activate products
                                </button>
                            </li>
                            <li>
                                <button
                                    class="w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
                                    onclick="onclick_action_button('DEACTIVATE')"
                                >Deactivate products
                                </button>
                            </li>
                            <li>
                                <button
                                    class="w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
                                    onclick="onclick_action_button('DELETE')"
                                >Delete products
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="search-bar-container flex justify-end">
                        <label for="table-search" class="sr-only">Search</label>
                        <div class="relative">
                            <input
                                type="text"
                                id="table-search-products"
                                class="block h-full text-gray-900 border border-gray-300 rounded-lg w-44 bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                placeholder="Search for products"
                            >
                        </div>
                        <button
                            class="inline-flex h-full items-center text-gray-500 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg px-3 py-2.5 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700"
                            onclick="filter_search_button(this)"
                        >
                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white p-3 md:p-5 flex flex-col items-center space-y-5">
            <table class="w-full text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="p-4">
                            <div class="flex items-center">
                                <input
                                    id="checkbox-all-search"
                                    type="checkbox"
                                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                                    onchange="onChange()"
                                >
                                <label for="checkbox-all-search" class="sr-only">checkbox</label>
                            </div>
                        </th>
                        <th scope="col" class="md:hidden text-center px-2 md:px-4 py-2">
                            Image
                        </th>
                        <th scope="col" class="hidden md:block text-center px-2 md:px-4 py-2">
                            Image(Name)
                        </th>
                        <th scope="col" class="text-center px-2 md:px-4 py-2">
                            Category
                        </th>
                        <th scope="col" class="text-center px-2 md:px-4 py-2">
                            Active
                        </th>
                        <th scope="col" class="text-center px-2 md:px-4 py-2">
                            Action
                        </th>
                    </tr>
                </thead>
                <tbody class="text-xs md:text-sm ">
                    {% for prod in prod_list %}
                    <tr
                        class="prod-row bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
                        data-value="{{prod.id}}"
                    >
                        <td class="w-4 p-4">
                            <div class="flex items-center">
                                <input
                                    type="checkbox"
                                    class="checkbox-action w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                                >
                                <!-- <label for="checkbox-table-search-1" class="sr-only">checkbox</label> -->
                            </div>
                        </td>
                        <td scope="row" class="flex items-center px-2 py-3 text-gray-900 whitespace-nowrap dark:text-white">
                            <img class="image-box w-40" src="{{prod.saved_image_url}}" onerror="this.onerror=null; this.src='{{prod.image_url}}';" alt="Uploading">
                            <div class="pl-3 hidden md:block w-80">
                                <div class="prod-name font-semibold text-ellipsis">{{prod.name}}</div>
                                <a class="font-normal text-gray-500 overflow-auto" href="{{prod.image_url}}" target="_blank">Click to move src image page</a>
                            </div>  
                        </td>
                        <td class="prod-category text-center px-2 md:px-4 py-4 items-center">
                            {% for key, value in cate_dict.items %}
                                {% if value == prod.category %}
                                    {{key}}
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td class="px-5 py-2">
                            <div class="flex items-center">
                                {% if prod.is_active == 'Y' %}
                                    <div class="h-2.5 w-2.5 rounded-full bg-green-500"></div>
                                {% else %}
                                    <div class="h-2.5 w-2.5 rounded-full bg-red-500"></div>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-2 md:px-4 py-2 text-center">
                            <!-- Modal toggle -->
                            <a
                                href="#{{prod.id}}"
                                type="button"
                                data-modal-target="editProductModal"
                                data-modal-show="editProductModal"
                                class="edit-btn font-medium text-blue-600 dark:text-blue-500 hover:underline"
                            >Edit</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- pagination -->
            <nav aria-label="Page navigation example">
                <ul class="flex items-center -space-x-px h-8 text-sm">
                    {% if page_links.previous %}
                    <li>
                        <a href="{{page_links.previous}}" class="flex items-center justify-center px-3 h-8 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                        <span class="sr-only">Previous</span>
                        <svg class="w-2.5 h-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                        </svg>
                        </a>
                    </li>
                    {% endif %}
                    {% for i in page_count %}
                        <li>
                            {% if i == page_num %}
                                <a href="?page={{i}}" class="z-10 flex items-center justify-center px-3 h-8 leading-tight text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white">
                            {% else %}
                                <a href="?page={{i}}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                            {% endif %}
                                    {{i}}
                                </a>
                        </li>
                    {% endfor %}
                    {% if page_links.next %}
                    <li>
                        <a href="{{page_links.next}}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                        <span class="sr-only">Next</span>
                        <svg class="w-2.5 h-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                        </svg>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        <!-- Edit product modal -->
        <div id="editProductModal" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 items-center justify-center hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative w-full max-w-2xl max-h-full">
                <!-- Modal content -->
                <form class="relative bg-white rounded-lg shadow dark:bg-gray-700" id="edit-product-form">
                    {% csrf_token %}
                    <!-- Modal header -->
                    <div class="flex items-start justify-between p-4 border-b rounded-t dark:border-gray-600">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                            Edit product
                        </h3>
                        <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="editProductModal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                    </div>
                    <!-- Modal body -->
                    <div class="modal-body p-6 space-y-6 text-xs md:text-sm">
                        <div class="grid grid-cols-6 gap-6">
                            <div class="col-span-6 sm:col-span-3">
                                <label for="name" class="block mb-2 font-medium text-gray-900 dark:text-white">Name</label>
                                <input type="text" name="name" id="name"
                                    class="text-xs md:text-sm shadow-sm bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                    placeholder="수정할 상품명을 입력하세요" required=""
                                />
                            </div>
                            <div class="col-span-6 sm:col-span-3">
                                <label
                                    for="category-select"
                                    class="block mb-2 font-medium text-gray-900 dark:text-white"
                                >Select a category
                                </label>
                                <select
                                    name="category"
                                    id="category-select"
                                    form="edit-product-form"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                >
                                    {% for key, value in cate_dict.items %}
                                        <option value="{{value}}">{{key}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- Modal footer -->
                    <div class="flex items-center p-6 space-x-2 border-t border-gray-200 rounded-b dark:border-gray-600">
                        <button
                            type="submit"
                            onclick="on_submit_edit()"
                            class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                            Save all
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>

<!-- Small Modal -->
<div id="small-modal" tabindex="-1" class="hidden fixed top-0 left-0 right-0 z-50 w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-5 border-b rounded-t dark:border-gray-600">
                <h3 class="text-xl font-medium text-gray-900 dark:text-white">
                    Add product
                </h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="small-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="w-full p-5">
                <form id="add-product-form" class="flex flex-col space-y-2">
                    {% csrf_token %}
                    <div class="relative w-full">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 20">
                                <path xmlns="http://www.w3.org/2000/svg" d="M6.92896 14.7205L6.45643 15.193C5.97241 15.677 5.31592 15.9488 4.63141 15.9488C3.94689 15.9488 3.29041 15.677 2.80638 15.193C2.32235 14.7091 2.05043 14.0527 2.05043 13.3682C2.05043 12.6838 2.32235 12.0274 2.80638 11.5435L6.44926 7.90115C6.94099 7.43196 7.59458 7.17018 8.27428 7.17018C8.95399 7.17018 9.60758 7.43196 10.0993 7.90115C10.2926 8.08784 10.5515 8.19114 10.8203 8.1888C11.0891 8.18647 11.3461 8.07868 11.5362 7.88867C11.7262 7.69865 11.834 7.4416 11.8364 7.17289C11.8387 6.90417 11.7354 6.64529 11.5487 6.452C10.6802 5.58378 9.50239 5.09603 8.27428 5.09603C7.04617 5.09603 5.86836 5.58378 4.9999 6.452L1.35702 10.0943C0.926887 10.5243 0.58566 11.0347 0.352822 11.5965C0.119985 12.1583 9.52375e-05 12.7604 5.67953e-08 13.3685C-0.000192169 14.5967 0.487574 15.7746 1.356 16.6432C2.22442 17.5117 3.40236 17.9998 4.63068 18C5.85901 18.0002 7.0371 17.5125 7.90579 16.6442L8.37832 16.1728C8.57065 15.9806 8.67876 15.7199 8.67886 15.448C8.67895 15.1762 8.57103 14.9154 8.37883 14.7231C8.18664 14.5308 7.92591 14.4227 7.654 14.4226C7.3821 14.4225 7.12129 14.5304 6.92896 14.7226V14.7205Z" fill="#2F2F38"/>
                                <path xmlns="http://www.w3.org/2000/svg" d="M16.6471 1.35334C15.778 0.486688 14.6006 0 13.3732 0C12.1457 0 10.9684 0.486688 10.0993 1.35334L9.37258 2.07894C9.27097 2.17258 9.18935 2.28578 9.13262 2.41176C9.0759 2.53774 9.04523 2.67389 9.04246 2.81202C9.0397 2.95015 9.0649 3.08742 9.11654 3.21556C9.16819 3.34371 9.24521 3.46009 9.34299 3.55772C9.44076 3.65534 9.55727 3.73219 9.68551 3.78365C9.81375 3.8351 9.95107 3.8601 10.0892 3.85714C10.2274 3.85418 10.3635 3.82333 10.4894 3.76643C10.6153 3.70953 10.7284 3.62776 10.8219 3.52604L11.5487 2.79941C12.0354 2.32877 12.6876 2.06822 13.3647 2.07393C14.0418 2.07964 14.6895 2.35115 15.1682 2.82993C15.6469 3.30871 15.9183 3.95641 15.9238 4.63339C15.9293 5.31037 15.6685 5.96241 15.1977 6.44893L11.5558 10.0913C11.064 10.5602 10.4105 10.8218 9.73082 10.8218C9.05119 10.8218 8.39764 10.5602 7.90579 10.0913C7.81124 9.99338 7.69813 9.91531 7.57308 9.8616C7.44802 9.80789 7.31352 9.77961 7.17742 9.77843C7.04132 9.77725 6.90635 9.80318 6.78038 9.85471C6.65441 9.90624 6.53997 9.98234 6.44373 10.0786C6.34749 10.1748 6.27138 10.2892 6.21984 10.4152C6.1683 10.5411 6.14236 10.6761 6.14355 10.8122C6.14473 10.9482 6.17301 11.0827 6.22673 11.2078C6.28045 11.3328 6.35853 11.4459 6.45643 11.5404C7.32489 12.4086 8.50271 12.8964 9.73082 12.8964C10.9589 12.8964 12.1367 12.4086 13.0052 11.5404L16.6471 7.89808C17.5135 7.02934 18 5.85255 18 4.62571C18 3.39887 17.5135 2.22208 16.6471 1.35334Z" fill="#2F2F38"/>
                            </svg>
                        </div>
                        <input name="image_url" type="text" id="simple-search" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Paste the image link" required>
                    </div>
                    <div class="relative w-full">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" viewBox="0 0 20 18" fill="none">
                                <path d="M12.687 14.408C12.2679 14.8265 11.7346 15.1121 11.154 15.229L7.588 15.942C7.10372 16.0388 6.60303 16.0146 6.13036 15.8715C5.65769 15.7284 5.22766 15.4708 4.87844 15.1215C4.52923 14.7723 4.27163 14.3423 4.12851 13.8696C3.98538 13.397 3.96116 12.8963 4.058 12.412L4.771 8.84599C4.88765 8.26526 5.17327 7.73194 5.592 7.31299L10.905 1.99999H2.167C1.59244 2.00052 1.04156 2.229 0.635284 2.63528C0.229008 3.04155 0.00052955 3.59243 0 4.16699V15.833C0.00052955 16.4076 0.229008 16.9584 0.635284 17.3647C1.04156 17.771 1.59244 17.9995 2.167 18H13.833C14.4076 17.9995 14.9584 17.771 15.3647 17.3647C15.771 16.9584 15.9995 16.4076 16 15.833V11.1L12.687 14.408Z" fill="#2F2F38"/>
                                <path d="M18.217 5.34299L18.763 4.79699C19.2349 4.32482 19.5 3.68457 19.5 3.01699C19.5 2.34942 19.2349 1.70917 18.763 1.23699C18.2837 0.779086 17.6464 0.52356 16.9835 0.52356C16.3206 0.52356 15.6833 0.779086 15.204 1.23699L14.657 1.78399L18.217 5.34299Z" fill="#2F2F38"/>
                                <path d="M13.243 3.19999L7.359 9.08099C7.28938 9.15102 7.24206 9.2401 7.223 9.33699L6.51 12.9C6.49517 12.9726 6.49669 13.0477 6.51444 13.1197C6.53219 13.1917 6.56573 13.2588 6.61263 13.3163C6.65954 13.3737 6.71863 13.42 6.78562 13.4518C6.85262 13.4835 6.92585 13.5 7 13.5C7.0336 13.5003 7.06712 13.4969 7.1 13.49L10.666 12.777C10.7625 12.7577 10.8512 12.7104 10.921 12.641L16.8 6.75699L13.243 3.19999Z" fill="#2F2F38"/>
                            </svg>
                        </div>
                        <input name="name" type="text" id="simple-search" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Put the product name" value="unnamed" required> 
                    </div>

                    <label
                        for="category-select"
                        class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                    >Select a category
                    </label>
                    <select
                        name="category"
                        id="category-select"
                        form="add-product-form"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                    >
                        {% for key, value in cate_dict.items %}
                            <option value="{{value}}">{{key}}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>
            <!-- Modal footer -->
            <div class="flex items-center p-6 space-x-2 border-t border-gray-200 rounded-b dark:border-gray-600">
                <button
                    data-modal-hide="small-modal"
                    type="submit"
                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                    onclick="on_submit_add();"
                >I accept</button>
                <button data-modal-hide="small-modal" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600">Decline</button>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block javascripts %}
<script>
    async function update_product_api(method, prod_id, data) {
        return axios({
            method: method,
            url: `/api/products/${prod_id}/`,
            headers: {
                "Content-Type": "multipart/form-data",
                'X-CSRFToken': '{{csrf_token}}'
            },
            data: data,
        }).then((res) => {
            return res;
        }).catch(() => {
            alert("ERROR")
        });
    }

    async function update_bulk_product_api(method, data) {
        return axios({
            method: method,
            url: `/api/products/bulk/`,
            headers: {
                "Content-Type": "multipart/form-data",
                'X-CSRFToken': '{{csrf_token}}'
            },
            data: data,
        }).then((res) => {
            return res;
        }).catch(() => {
            alert("ERROR")
        });
    }

    async function delete_bulk_product_api(method, data) {
        return axios({
            method: method,
            url: `/api/products/bulk/`,
            headers: {
                "Content-Type": "multipart/form-data",
                'X-CSRFToken': '{{csrf_token}}'
            },
            data: data,
        }).then((res) => {
            return res;
        }).catch(() => {
            alert("ERROR")
        });
    }

    async function create_product_api(data) {
        return axios({
            url: `/api/products/`,
            method: 'post',
            headers: {
                "Content-Type": "multipart/form-data",
                'X-CSRFToken': '{{csrf_token}}'
            },
            data: data,
        }).then((res) => {
            return res;
        }).catch(() => {
            alert("ERROR")
        });
    }

    const on_submit_edit = async () => {
        const prod_id = location.hash.substring(1);
        const form_object = document.getElementById('edit-product-form');
        const bodyFormData = new FormData(form_object);
        if (!confirm('Are you sure you want to update?')) {
            return;
        } 
        await update_product_api('patch', prod_id, bodyFormData);
    }

    const list = document.querySelectorAll('.edit-btn');
    list.forEach((elem) => {
        elem.addEventListener('click', () => {
            const prod_id = location.hash.substring(1);
            const prod_name = elem.closest('.prod-row').querySelector('.prod-name').textContent.trim();
            const prod_cate = elem.closest('.prod-row').querySelector('.prod-category').textContent.trim();

            const modal_body = document.querySelector('.modal-body');
            modal_body.querySelector('input[name=name]').value = prod_name;
            const select_options = Array.from(modal_body.querySelector('select[name=category]').children);
            select_options.forEach((opt) => {
                if (opt.text === prod_cate) {
                    opt.selected = true;
                }
            });
        });
    })

    const on_submit_add = async () => {
        const form_object = document.getElementById('add-product-form');
        const bodyFormData = new FormData(form_object);
        if (!confirm('Are you sure you want to add?\n(take some time to upload the product.)')) {
            return
        } 
        await create_product_api(bodyFormData)
        show_loading_indicator();
        await setTimeout(function() {
            location.reload();
        }, 3000);
    }

    const onclick_action_button = async (type) => {
        const checkboxes = Array.from(document.querySelectorAll('.checkbox-action'));
        const prod_id_list = [];
        checkboxes.forEach((checkbox) => {
            if (checkbox.checked) {
                const prod_id = checkbox.closest('.prod-row').dataset.value
                prod_id_list.push(prod_id)
            }
        });
        if (
            !confirm('Are you sure want to proceed?')
            || prod_id_list.length === 0
        ) {
            return ;
        }

        let data = {}
        if (type === 'ACTIVATE') {
            data.prod_list = prod_id_list;
            data.is_active = 'Y';
        } else if (type === 'DEACTIVATE') {
            data.prod_list = prod_id_list;
            data.is_active = 'N';
        } else if (type === 'DELETE') {
            data.prod_list = prod_id_list;
        }

        if (type === 'DELETE') {
            await delete_bulk_product_api('delete', data)
        } else {
            await update_bulk_product_api('patch', data)
        }
        show_loading_indicator();
        await setTimeout(function() {
            location.reload();
        }, 2000);
    }

    const show_loading_indicator = () => {
        const loading_indicator = document.getElementById('loading-indicator');
        console.log(loading_indicator)
        loading_indicator.classList.remove('hidden');
    }

    const onChange = () => {
        const all_check_box = document.getElementById('checkbox-all-search');
        const checkboxes = Array.from(document.querySelectorAll('.checkbox-action'));
        
        checkboxes.forEach((checkbox) => {
            checkbox.checked = all_check_box.checked;
        });
    }

    const filter_search_button = (obj) => {
        const filter_value = obj.closest('.search-bar-container').querySelector('input').value;
        const url = new URL(location.href)
        location.href = `${url.origin}/?search=${filter_value}`
    }

</script>
{% endblock %}