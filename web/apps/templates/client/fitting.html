{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="flex flex-col h-screen bg-white">
    <div class="flex flex-col items-center w-full -space-y-20">
        {% for prod_info in data %}
            {% if prod_info.prod_list %}
                <div class="gallery-container flex">
                    <div class="flex flex-col relative w-72 h-72 justify-center items-center">
                        {% if prod_info.prod_list|length  > 1 %}
                        <div id="gallery" class="gallery relative w-48 h-52 translate translate-x-0 -translate-y-6" data-carousel="static">
                            <!-- Carousel wrapper -->
                            <div class="flex flex-col justify-center items-center relative overflow-hidden rounded-lg w-full h-full right-0 left-0">
                                {% for prod in prod_info.prod_list %}
                                    <div class="hidden duration-700 ease-in-out backdrop-opacity-0" data-carousel-item>
                                        <img src="{{prod.saved_image_url}}" onerror="this.onerror=null; this.src='{{prod.image_url}}';" class="absolute block -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="">
                                    </div>
                                {% endfor %}
                            </div>
                            <!-- Slider controls -->
                            <button
                                type="button"
                                class="hidden absolute top-0 -left-7 z-30 items-center justify-center h-full px-0 cursor-pointer group focus:outline-none" data-carousel-prev
                                id="prev-btn-{{prod_info.category}}"
                            >
                                <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-white dark:text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                                    </svg>
                                    <span class="sr-only">Previous</span>
                                </span>
                            </button>
                            <button
                                type="button"
                                class="hidden absolute top-0 -right-7 z-30 items-center justify-center h-full px-0 cursor-pointer group focus:outline-none" data-carousel-next
                                id="next-btn-{{prod_info.category}}"
                            >
                                <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-white dark:text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                                    </svg>
                                    <span class="sr-only">Next</span>
                                </span>
                            </button>
                        </div>
                        {% else %}
                        <div id="gallery" class="gallery relative w-48 h-52 translate translate-x-0 -translate-y-6">
                            <div class="flex flex-col justify-center items-center relative overflow-hidden rounded-lg w-full h-full right-0 left-0">
                                {% for prod in prod_info.prod_list %}
                                    <img src="{{prod.saved_image_url}}" onerror="this.onerror=null; this.src='{{prod.image_url}}';" class="absolute block -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="">
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if prod_info.prod_list|length  > 1 %}
                        <!-- Slider controls -->
                        <button
                            type="button"
                            class="fitting-choose-btn absolute top-0 left-5 z-30 flex items-center justify-center px-0 cursor-pointer group focus:outline-none" data-carousel-prev
                            onclick="document.getElementById('prev-btn-{{prod_info.category}}').click();"
                        >
                            <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                <svg class="w-5 h-5 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5H1m0 0 4 4M1 5l4-4"></path>
                                </svg>
                                <!-- <svg class="w-4 h-4 text-gray-800 dark:text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                                </svg> -->
                                <span class="sr-only">Previous</span>
                            </span>
                        </button>
                        <button
                            type="button"
                            class="fitting-choose-btn absolute top-0 right-5 z-30 flex items-center justify-center px-0 cursor-pointer group focus:outline-none" data-carousel-next
                            onclick="document.getElementById('next-btn-{{prod_info.category}}').click();"
                        >
                            <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                <svg class="w-5 h-5 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"></path>
                                </svg>
                                <!-- <svg class="w-4 h-4 text-gray-800 dark:text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                                </svg> -->
                                <span class="sr-only">Next</span>
                            </span>
                        </button>
                        {% endif %}
                    </div>
                    <div class="flex flex-col justify-center">
                        <div class="fitting-control-btn-container">
                            <button
                                class="fitting-size-btn z-30 flex items-center justify-center cursor-pointer group focus:outline-none"
                                onclick="sizeup(this)"
                            >
                                <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 18">
                                        <path d="M18 .989a1.016 1.016 0 0 0-.056-.277c-.011-.034-.009-.073-.023-.1a.786.786 0 0 0-.066-.1.979.979 0 0 0-.156-.224l-.007-.01a.873.873 0 0 0-.116-.073.985.985 0 0 0-.2-.128.959.959 0 0 0-.231-.047A.925.925 0 0 0 17 0h-4a1 1 0 1 0 0 2h1.664l-3.388 3.552a1 1 0 0 0 1.448 1.381L16 3.5V5a1 1 0 0 0 2 0V.989ZM17 12a1 1 0 0 0-1 1v1.586l-3.293-3.293a1 1 0 0 0-1.414 1.414L14.586 16H13a1 1 0 0 0 0 2h4a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1ZM3.414 2H5a1 1 0 0 0 0-2H1a1 1 0 0 0-1 1v4a1 1 0 0 0 2 0V3.414l3.536 3.535A1 1 0 0 0 6.95 5.535L3.414 2Zm2.139 9.276L2 14.665V13a1 1 0 1 0-2 0v4c.006.046.015.09.027.135.006.08.022.16.048.235a.954.954 0 0 0 .128.2.95.95 0 0 0 .073.117l.01.007A.983.983 0 0 0 1 18h4a1 1 0 0 0 0-2H3.5l3.436-3.276a1 1 0 0 0-1.38-1.448h-.003Z"/>
                                    </svg>
                                    <span class="sr-only">up</span>
                                </span>
                            </button>
                            <button
                                class="fitting-size-btn z-30 flex items-center justify-center cursor-pointer group focus:outline-none"
                                onclick="sizedown(this)"
                            >
                                <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M7 1a1 1 0 0 0-1 1v2.586L2.707 1.293a1 1 0 0 0-1.414 1.414L4.586 6H2a1 1 0 0 0 0 2h5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Zm0 11H2a1 1 0 1 0 0 2h2.586l-3.293 3.293a1 1 0 1 0 1.414 1.414L6 15.414V18a1 1 0 1 0 2 0v-5a1 1 0 0 0-1-1Zm11-6h-2.586l3.293-3.293a1 1 0 1 0-1.414-1.414L14 4.586V2a1 1 0 0 0-2 0v5a1 1 0 0 0 1 1h5a1 1 0 1 0 0-2Zm1 7a1 1 0 0 0-1-1h-5a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0v-2.586l3.293 3.293a1 1 0 0 0 1.414-1.414L15.414 14H18a1 1 0 0 0 1-1Z"/>
                                    </svg>
                                    <span class="sr-only">down</span>
                                </span>
                            </button>
                            <button
                                class="fitting-pose-btn"
                                onclick="posedown(this)"
                            >
                                <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 8">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 5.326 5.7a.909.909 0 0 0 1.348 0L13 1"></path>
                                    </svg>
                                    <span class="sr-only">up</span>
                                </span>
                            </button>
                            <button
                                class="fitting-pose-btn"
                                onclick="poseup(this)"
                            >
                                <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 8">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7 7.674 1.3a.91.91 0 0 0-1.348 0L1 7"></path>
                                    </svg>
                                    <span class="sr-only">up</span>
                                </span>
                            </button>
                            <button
                                class="fitting-pose-btn"
                                onclick="poseleft(this)"
                            >
                                <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 14">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 1 1.3 6.326a.91.91 0 0 0 0 1.348L7 13"></path>
                                    </svg>
                                    <span class="sr-only">up</span>
                                </span>
                            </button>
                            <button
                                class="fitting-pose-btn"
                                onclick="poseright(this)"
                            >
                                <span class="inline-flex items-center justify-center bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                                    <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 14">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 13 5.7-5.326a.909.909 0 0 0 0-1.348L1 1"></path>
                                    </svg>
                                    <span class="sr-only">up</span>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock content %}

{% block javascripts %}
<script>
    const get_class_object_by_prefix = (class_name_list, class_prefix, diff, limit) => {
        let class_name = Array.from(class_name_list).find((elem) => {
                                return elem.startsWith(`${class_prefix}-`) || elem.startsWith(`-${class_prefix}-`)
                            });
        const origin_class_name = class_name;
        class_name = class_name[0] === '-' ? class_name.slice(1) : class_name
        const class_name_parts = class_name.split('-');
        if (diff > 0 && parseInt(class_name_parts[class_name_parts.length - 1]) + diff >= limit) {
            return {
                'origin': class_name,
                'new': class_name,
            }
        }
        if (diff < 0 && parseInt(class_name_parts[class_name_parts.length - 1]) + diff <= limit) {
            return {
                'origin': class_name,
                'new': class_name,
            }
        }
        class_name_parts[class_name_parts.length - 1] = String(parseInt(class_name_parts[class_name_parts.length - 1]) + diff);
        const new_class_name = class_name_parts.join('-');
        return {
            'origin': origin_class_name,
            'new': new_class_name,
        }
    }

    const DEFAULT_SIZE_W = 48;
    const DEFAULT_SIZE_H = 52;

    const sizeup = (btn_obj) => {
        const gallery_obj = btn_obj.closest('.gallery-container').querySelector('.gallery');
        const class_object_width = get_class_object_by_prefix(gallery_obj.classList, 'w', 4, DEFAULT_SIZE_W + 10)
        gallery_obj.classList.replace(class_object_width.origin, class_object_width.new)
        const class_object_height = get_class_object_by_prefix(gallery_obj.classList, 'h', 4, DEFAULT_SIZE_H + 10)
        gallery_obj.classList.replace(class_object_height.origin, class_object_height.new)
    }
    const sizedown = (btn_obj) => {
        const gallery_obj = btn_obj.closest('.gallery-container').querySelector('.gallery');
        const class_object_width = get_class_object_by_prefix(gallery_obj.classList, 'w', -4, DEFAULT_SIZE_W - 10)
        gallery_obj.classList.replace(class_object_width.origin, class_object_width.new)
        const class_object_height = get_class_object_by_prefix(gallery_obj.classList, 'h', -4, DEFAULT_SIZE_H - 10)
        gallery_obj.classList.replace(class_object_height.origin, class_object_height.new)
    }

    const DEFAULT_POSE_X = 0;
    const DEFAULT_POSE_Y = 0;
    const poseup = (btn_obj) => {
        const gallery_obj = btn_obj.closest('.gallery-container').querySelector('.gallery');
        const class_object = get_class_object_by_prefix(gallery_obj.classList, 'translate-y', 1, 13)
        gallery_obj.classList.replace(class_object.origin, `-${class_object.new}`)
    }
    const posedown = (btn_obj) => {
        const gallery_obj = btn_obj.closest('.gallery-container').querySelector('.gallery');
        const class_object = get_class_object_by_prefix(gallery_obj.classList, 'translate-y', -1, 0)
        gallery_obj.classList.replace(class_object.origin, `-${class_object.new}`)
    }
    const poseright = (btn_obj) => {
        const gallery_obj = btn_obj.closest('.gallery-container').querySelector('.gallery');
        const class_object = get_class_object_by_prefix(gallery_obj.classList, 'translate-x', -1, 0)
        gallery_obj.classList.replace(class_object.origin, `-${class_object.new}`)
    }
    const poseleft = (btn_obj) => {
        const gallery_obj = btn_obj.closest('.gallery-container').querySelector('.gallery');
        const class_object = get_class_object_by_prefix(gallery_obj.classList, 'translate-x', 1, 7)
        gallery_obj.classList.replace(class_object.origin, `-${class_object.new}`)
    }

</script>
{% endblock %}